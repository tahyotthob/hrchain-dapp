{"ast":null,"code":"import EventEmitter from \"eventemitter3\";\nimport { JsonRpcProvider } from \"@walletconnect/jsonrpc-provider\";\nimport { HttpConnection } from \"@walletconnect/jsonrpc-http-connection\";\nimport { getRpcUrl, signingMethods } from \"@walletconnect/utils\";\nimport { SignerConnection } from \"@walletconnect/signer-connection\";\nclass WalletConnectProvider {\n  constructor(opts) {\n    this.events = new EventEmitter();\n    this.rpc = {\n      infuraId: opts === null || opts === void 0 ? void 0 : opts.infuraId,\n      custom: opts === null || opts === void 0 ? void 0 : opts.rpc\n    };\n    this.signer = new JsonRpcProvider(new SignerConnection(opts));\n    const chainId = this.signer.connection.chainId || (opts === null || opts === void 0 ? void 0 : opts.chainId) || 1;\n    this.http = this.setHttpProvider(chainId);\n    this.registerEventListeners();\n  }\n  get connected() {\n    return this.signer.connection.connected;\n  }\n  get connector() {\n    return this.signer.connection.connector;\n  }\n  get accounts() {\n    return this.signer.connection.accounts;\n  }\n  get chainId() {\n    return this.signer.connection.chainId;\n  }\n  get rpcUrl() {\n    var _a;\n    return ((_a = this.http) === null || _a === void 0 ? void 0 : _a.connection).url || \"\";\n  }\n  async request(args) {\n    switch (args.method) {\n      case \"eth_requestAccounts\":\n        await this.connect();\n        return this.signer.connection.accounts;\n      case \"eth_accounts\":\n        return this.signer.connection.accounts;\n      case \"eth_chainId\":\n        return this.signer.connection.chainId;\n      default:\n        break;\n    }\n    if (signingMethods.includes(args.method)) {\n      return this.signer.request(args);\n    }\n    if (typeof this.http === \"undefined\") {\n      throw new Error(`Cannot request JSON-RPC method (${args.method}) without provided rpc url`);\n    }\n    return this.http.request(args);\n  }\n  sendAsync(args, callback) {\n    this.request(args).then(response => callback(null, response)).catch(error => callback(error, undefined));\n  }\n  async enable() {\n    const accounts = await this.request({\n      method: \"eth_requestAccounts\"\n    });\n    return accounts;\n  }\n  async connect() {\n    if (!this.signer.connection.connected) {\n      await this.signer.connect();\n    }\n  }\n  async disconnect() {\n    if (this.signer.connection.connected) {\n      await this.signer.disconnect();\n    }\n  }\n  on(event, listener) {\n    this.events.on(event, listener);\n  }\n  once(event, listener) {\n    this.events.once(event, listener);\n  }\n  removeListener(event, listener) {\n    this.events.removeListener(event, listener);\n  }\n  off(event, listener) {\n    this.events.off(event, listener);\n  }\n  get isWalletConnect() {\n    return true;\n  }\n  registerEventListeners() {\n    this.signer.connection.on(\"accountsChanged\", accounts => {\n      this.events.emit(\"accountsChanged\", accounts);\n    });\n    this.signer.connection.on(\"chainChanged\", chainId => {\n      this.http = this.setHttpProvider(chainId);\n      this.events.emit(\"chainChanged\", chainId);\n    });\n    this.signer.on(\"disconnect\", () => {\n      this.events.emit(\"disconnect\");\n    });\n  }\n  setHttpProvider(chainId) {\n    const rpcUrl = getRpcUrl(chainId, this.rpc);\n    if (typeof rpcUrl === \"undefined\") return undefined;\n    const http = new JsonRpcProvider(new HttpConnection(rpcUrl));\n    return http;\n  }\n}\nexport default WalletConnectProvider;","map":{"version":3,"names":["EventEmitter","JsonRpcProvider","HttpConnection","getRpcUrl","signingMethods","SignerConnection","WalletConnectProvider","constructor","opts","events","rpc","infuraId","custom","signer","chainId","connection","http","setHttpProvider","registerEventListeners","connected","connector","accounts","rpcUrl","_a","url","request","args","method","connect","includes","Error","sendAsync","callback","then","response","catch","error","undefined","enable","disconnect","on","event","listener","once","removeListener","off","isWalletConnect","emit"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}